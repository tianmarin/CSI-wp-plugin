jQuery(document).ready(function($){var e=csiTemplateEwaUpload.ajaxUrl;$("#csi-ewa-upload-print").click(function(){window.print()}),$("#csi-ewa-upload-form").submit(function(a){var t=$(this).find(":input[type=submit]");t.html(t.data("loading-text")),t.addClass("disabled"),a.preventDefault();var n=this,r=$(this).find("input[type=file]")[0].files[0];if(void 0===typeof r||"undefined"==typeof r)return $(this).find("input[type=file]").parent().parent().addClass("has-error"),t.html(t.data("normal-text")),t.removeClass("disabled"),window.console.log("No hay archivo. Undefined"),this;if($(this).find("input[type=file]").parent().parent().removeClass("has-error"),""===r.name.trim())return t.html(t.data("normal-text")),t.removeClass("disabled"),$.alert("No has seleccionado un archivo."),window.console.log("No file selected"),this;window.console.log("Archivo a evaluar: "+r.name+" "+r.type+" "+r.size);var s=["text/csv","text/plain","application/vmd.ms-excel"];if(-1>=$.inArray(r.type,s))return t.html(t.data("normal-text")),t.removeClass("disabled"),window.console.log(r.type),$.alert("Recuerda que debes cargar archivos guardados como CSV","Error"),this;var i=new FormData;i.append("action","csi_ajax_upload_ewa_file"),i.append("file",r),$.ajax({url:e,type:"POST",data:i,cache:!1,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){},xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var o=Math.round(e.loaded/e.total*100);window.console.log("Porcentaje: "+o)}},!1),e.upload.addEventListener("load",function(e){e.lengthComputable},!1),e.addEventListener("progress",function(e){e.lengthComputable?window.console.log("Respuesta descargada: "+Math.round(e.loaded/e.total*100)+"%"):window.console.log("Respuesta descargada: "+Math.round(e.loaded/e.total*100)+"%")},!1),e},success:function(e){window.console.log(JSON.stringify(e));var o=$("#csi-ewa-upload-status");o.append(e.message),$(n).fadeOut("400",function(){o.fadeIn()})},error:o})});var o;void 0===typeof o&&(o=function(o,a,t){var n="";window.console.log(typeof o),"undefined"!=typeof o&&(n=0===o.status?"Not connect.\n Verify Network.":404===o.status?"Requested page not found. [404]":500===o.status?"Internal Server Error [500].":"parsererror"===a?"Requested JSON parse failed.":"timeout"===a?"Time out error.":"abort"===a?"Ajax request aborted.":"Uncaught Error.\n"+o.responseText),window.console.log("ERROR: "),window.console.log(o),window.console.log(a+" - "+t);var r="Este error de conexión con el servidor de fondo, regularmente indica que no has iniciado sesión en Wordpress.<br/>";window.console.log(e);var s=e.replace("admin-ajax.php","");r=r+"Intenta <strong><a href='"+s+"'>iniciar sesi&oacute;n</a></strong>. En caso que esto no funcione, por favor contacta al adminsitrador.",r=r+"<code>"+n+"</code>";var i="Error de conexión as&iacute;ncrona";$.alert({buttons:{heyThere:{text:"OK",btnClass:"btn-danger"}},closeIcon:!0,columnClass:"large",content:r,title:i,type:"red"})})});